kind: pipeline
name: default

trigger:
  event:
    include:
    - tag

steps:
- name: build-image
  image: plugins/gcr
  settings:
    registry: eu.gcr.io
    repo: zeitonline-210413/zon-drone-kubectl
    tags:
      - latest
      - ${DRONE_TAG}
    environment:
      VERSION: "${DRONE_TAG}"
    json_key:
      from_secret: GCP_SERVICE_ACCOUNT
    context: plugins/kubectl
    dockerfile: plugins/kubectl/Dockerfile
  purge: false
  volumes:
    - name: docker
      path: /var/run/docker.sock

volumes:
- name: docker
  host:
    path: /var/run/docker.sock

